<!DOCTYPE html><html lang="pl"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Moja biblioteka â€¢ StreamingHub</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>:root{--bg:#0b0d10;--card:#151922;--text:#e3e7ee;--muted:#a8bfe2;--brand:#4f7cff;--border:#232a37;--danger:#c24b4b;--success:#22c55e}*{box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;min-height:100vh}.container{max-width:1100px;margin:0 auto;padding:16px}header{position:sticky;top:0;background:rgba(11,13,16,.8);backdrop-filter:blur(6px);z-index:10}.nav{display:flex;gap:12px;align-items:center;padding:12px 16px}.brand{font-weight:800;text-decoration:none;color:#fff}.menu a,.menu button{padding:8px 10px;color:var(--muted);background:0 0;border:none;cursor:pointer;text-decoration:none}.btn{background:var(--brand);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600;transition:opacity .2s}.btn:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.btn.secondary{background:#2a3446}.btn.danger{background:var(--danger)}.btn.success{background:var(--success)}.small-btn{padding:6px 10px;border-radius:8px;background:#2a3446;color:#fff;border:none;cursor:pointer}.card{background:var(--card);border:1px solid var(--border);padding:16px;border-radius:12px;margin-top:16px}.row-scroll{display:flex;gap:12px;overflow-x:auto;padding-bottom:4px}.item{background:#0e1218;border:1px solid var(--border);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center;min-width:320px;justify-content:space-between}.thumb{width:120px;height:80px;object-fit:cover;border-radius:8px;background:#000}.top-row{display:flex;justify-content:space-between;align-items:center}input,textarea{width:100%;padding:8px;margin-top:4px;border-radius:8px;border:1px solid var(--border);background:#0e1218;color:var(--text);-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.muted-block{color:var(--muted);margin-top:8px;font-size:13px}footer{color:var(--muted);text-align:center;padding:30px 0}.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.92);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center;z-index:100}.modal{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:25px;max-width:500px;width:90%;display:flex;flex-direction:column;animation:fadeIn .25s ease;text-align:center}.ad-frame-wrapper{background:#000;border-radius:8px;min-height:250px;margin:20px 0;display:flex;justify-content:center;align-items:center;border:1px dashed var(--border)}.timer-display{font-size:2rem;font-weight:700;color:var(--brand);margin:10px 0}@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@media (max-width:900px){.nav{flex-direction:column;align-items:stretch;padding:8px 12px;gap:8px}.menu{justify-content:center}.card img{height:180px}.container{padding:12px}}@media (max-width:600px){.grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}.btn{padding:8px 12px;font-size:14px}h1,h2,h3{font-size:1.1rem}.card img{height:150px}input,select,textarea{font-size:14px}.flex{gap:8px}}@media (max-width:400px){.nav{padding:6px}.nav input[type=search]{padding:8px;font-size:13px}.menu a,.menu button{font-size:13px}.grid{grid-template-columns:1fr 1fr;gap:8px}.card img{height:130px}footer{font-size:12px}}</style></head><body oncontextmenu="return false"><header><div class="nav container"><a class="brand" href="/filmy/">ğŸ¬ StreamingHub</a><nav class="menu" style="margin-left:auto"><a href="/filmy/">Filmy</a> <a href="/seriale/">Seriale</a> <a href="/top/">TOP</a> <a href="/moja-biblioteka/" style="color:#fff">Moja biblioteka</a> <button onclick="logout()" class="btn secondary">Wyloguj</button></nav></div></header><main class="container" id="app"><h1>Moja biblioteka</h1><section id="pointsBox" class="card"><h2>ğŸ¯ Twoje punkty: <span id="points">...</span></h2><div id="adContainer"><button id="watchAdBtn" class="btn">ğŸ¬ Obejrzyj reklamÄ™ (+50 pkt)</button><p id="cooldownMsg" class="muted-block" style="color:#e5a50a;display:none"></p></div><hr style="margin:20px 0;border-color:var(--border)"><h3>ğŸŸ Wykorzystaj kod</h3><input id="codeInput" placeholder="Wpisz kod promocyjny"> <button class="btn" onclick="redeemCode()">Aktywuj</button><p id="codeMessage" class="muted-block"></p></section><section id="friendsBox" class="card"><h2>ğŸ§‘â€ğŸ¤â€ğŸ§‘ SpoÅ‚ecznoÅ›Ä‡</h2><p>PoÅ‚Ä…cz siÄ™ ze znajomymi i oglÄ…daj razem filmy!</p><div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn" onclick="location.href='/znajomi/'">ğŸ‘¥ Znajomi</button> <button class="btn secondary" onclick="location.href='wspolne-oglÄ…danie.html'">ğŸ¥ WspÃ³lne oglÄ…danie</button></div></section><section id="profileBox" class="card"><h2>ğŸ‘¤ ZmieÅ„ dane profilu</h2><label>Nazwa uÅ¼ytkownika</label> <input type="text" id="usernameInput" placeholder="Nowa nazwa"> <label>Opis (bio)</label> <textarea id="bioInput" placeholder="Napisz coÅ› o sobie..."></textarea> <button class="btn" onclick="updateProfile()">ğŸ’¾ Zapisz zmiany</button></section><section id="passwordBox" class="card"><h2>ğŸ” ZmieÅ„ hasÅ‚o</h2><input type="password" id="currentPassword" placeholder="Obecne hasÅ‚o"> <input type="password" id="newPassword" placeholder="Nowe hasÅ‚o"> <input type="password" id="confirmPassword" placeholder="PowtÃ³rz nowe hasÅ‚o"> <button class="btn" onclick="changePassword()">ZmieÅ„ hasÅ‚o</button></section><section id="filmsBox" class="card"><div class="top-row"><h2>ğŸ Historia oglÄ…dania â€” Filmy</h2><button class="btn secondary" onclick="openHistoryModal('movie')">PokaÅ¼ caÅ‚Ä… historiÄ™</button></div><div id="filmsList" class="row-scroll"></div></section><section id="seriesBox" class="card"><div class="top-row"><h2>ğŸ“º Historia oglÄ…dania â€” Seriale</h2><button class="btn secondary" onclick="openHistoryModal('series')">PokaÅ¼ caÅ‚Ä… historiÄ™</button></div><div id="seriesList" class="row-scroll"></div></section></main><footer>Â© <script>document.write(new Date().getFullYear())</script> StreamingHub</footer><div id="historyModalContainer"></div><div id="adModalContainer"></div><script>document.addEventListener("keydown",function(e){if(123==e.keyCode||e.ctrlKey&&e.shiftKey&&73==e.keyCode||e.ctrlKey&&e.shiftKey&&67==e.keyCode||e.ctrlKey&&e.shiftKey&&74==e.keyCode||e.ctrlKey&&85==e.keyCode)return e.preventDefault(),!1});const _0x5a1b="https://jjmnacolebxsifmnmqks.supabase.co",_0x2b3c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqbW5hY29sZWJ4c2lmbW5tcWtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTcyNDQsImV4cCI6MjA3MTM3MzI0NH0.1hNoBQ4wDuA_t_vscorQ6FRb-aW8IxHEDxuZKEhndv0",db=supabase.createClient(_0x5a1b,_0x2b3c);let currentUser=null;const AD_COOLDOWN_MINUTES=3,POINTS_REWARD=50,AD_DURATION=25;async function initiateAdProcess(){const e=document.getElementById("watchAdBtn");e.disabled=!0,(await checkCooldownState())?showAdModal():e.disabled=!1}function showAdModal(){document.getElementById("adModalContainer").innerHTML="<div class='modal-backdrop'><div class='modal' id='adModalContent'><h3 style='margin:0'>â³ Reklama w toku...</h3><p class='muted-block'>Obejrzyj reklamÄ™ poniÅ¼ej, aby otrzymaÄ‡ punkty.</p><div class='ad-frame-wrapper'><iframe data-aa='2421578' src='//acceptable.a-ads.com/2421578/?size=Adaptive' style='border:0; width:100%; height:250px;'></iframe></div><div class='timer-display' id='adTimer'>"+AD_DURATION+"s</div><p class='muted-block' style='font-size: 11px;'>Nie zamykaj tego okna przed czasem.</p></div></div>",startAdCounter()}let currentTimer=null;function startAdCounter(){const e=document.getElementById("adTimer");currentTimer&&clearInterval(currentTimer);let t=AD_DURATION;currentTimer=setInterval(()=>{t--,e.textContent=t+"s",t<=0&&(clearInterval(currentTimer),prepareReward())},1e3)}function prepareReward(){document.getElementById("adModalContent").innerHTML="<div style='padding: 30px 0;'><div style='font-size: 50px;'>ğŸ</div><h2 style='margin:10px 0;'>Gotowe!</h2><p class='muted-block'>Reklama zweryfikowana. Odbierz swoje punkty.</p><button class='btn success' style='width:100%; padding: 15px; margin-top:20px;' onclick='finishAdSuccess()'>ğŸ’° ODBIERZ 50 PKT</button></div>"}async function finishAdSuccess(){document.getElementById("adModalContainer").innerHTML="";try{const{data:e}=await db.from("profiles").select("points").eq("id",currentUser.id).single(),t=(e?.points||0)+POINTS_REWARD;await db.from("profiles").update({points:t,last_ad_watched:(new Date).toISOString()}).eq("id",currentUser.id),alert("âœ… Dodano +"+POINTS_REWARD+" pkt!"),await loadPoints(),await checkCooldownState()}catch(e){alert("BÅ‚Ä…d poÅ‚Ä…czenia.")}}async function checkCooldownState(){const e=document.getElementById("watchAdBtn"),t=document.getElementById("cooldownMsg"),{data:n}=await db.from("profiles").select("last_ad_watched").eq("id",currentUser.id).single();if(!n||!n.last_ad_watched)return e.disabled=!1,t.style.display="none",!0;const o=((new Date)-(new Date(n.last_ad_watched)))/6e4;if(o<AD_COOLDOWN_MINUTES){const n=Math.ceil(AD_COOLDOWN_MINUTES-o);return e.disabled=!0,e.textContent="Poczekaj "+n+" min",t.textContent="Kolejna nagroda za "+n+" minut.",t.style.display="block",!1}return e.disabled=!1,e.textContent="ğŸ¬ Obejrzyj reklamÄ™ (+"+POINTS_REWARD+" pkt)",t.style.display="none",!0}async function loadProfile(){const{data:e}=await db.from("profiles").select("username,bio").eq("id",currentUser.id).maybeSingle();e&&(document.getElementById("usernameInput").value=e.username||"",document.getElementById("bioInput").value=e.bio||"")}async function updateProfile(){const e=document.getElementById("usernameInput").value.trim(),t=document.getElementById("bioInput").value.trim();return e?(await db.from("profiles").update({username:e,bio:t}).eq("id",currentUser.id),void alert("âœ… Zaktualizowano profil!")):alert("Podaj nazwÄ™ uÅ¼ytkownika")}async function loadPoints(){const{data:e}=await db.from("profiles").select("points").eq("id",currentUser.id).maybeSingle();document.getElementById("points").textContent=e?.points??0}async function redeemCode(){const e=document.getElementById("codeInput"),t=e.value.trim(),{data:n}=await db.from("codes").select("*").eq("code",t).maybeSingle();if(!n||n.limit_left<=0)return alert("Kod nieprawidÅ‚owy");const{data:o}=await db.from("profiles").select("points").eq("id",currentUser.id).maybeSingle();await db.from("profiles").update({points:(o?.points||0)+n.amount}).eq("id",currentUser.id),await db.from("codes").update({limit_left:n.limit_left-1}).eq("id",n.id),alert("âœ… Kod aktywowany!"),e.value="",loadPoints()}async function loadCompactHistory(){const{data:e}=await db.from("watch_history").select("*").eq("user_id",currentUser.id).order("watched_at",{ascending:!1}).limit(100),t=[...new Map(e.filter(e=>e.movie_id).map(e=>[e.movie_id,e])).values()].slice(0,6),n=[...new Map(e.filter(e=>e.episode_id).map(e=>[e.episode_id,e])).values()].slice(0,6);document.getElementById("filmsList").innerHTML=await makeFilmsHtml(t),document.getElementById("seriesList").innerHTML=await makeSeriesHtml(n)}async function makeFilmsHtml(e){if(!e.length)return"<div class='muted-block'>Brak historii.</div>";const{data:t}=await db.from("movies").select("id,title,thumb").in("id",e.map(e=>e.movie_id)),n=new Map(t.map(e=>[e.id,e]));return e.map(e=>{const t=n.get(e.movie_id);return`<div class='item'><div style="display:flex;gap:12px;align-items:center;"><img class='thumb' src='${t?.thumb||""}'><div><b>${t?.title||"Film"}</b><div class='muted-block'>${(new Date(e.watched_at)).toLocaleString()}</div></div></div><button class='small-btn' onclick="location.href='filmy.html?id=${t?.id}'">â–¶</button></div>`}).join("")}async function makeSeriesHtml(e){if(!e.length)return"<div class='muted-block'>Brak historii.</div>";const{data:t}=await db.from("episodes").select("id,series_id,season,episode,thumb").in("id",e.map(e=>e.episode_id)),n=[...new Set(t.map(e=>e.series_id))],{data:o}=await db.from("series").select("id,title,thumb").in("id",n),a=new Map(o.map(e=>[e.id,e])),r=new Map(t.map(e=>[e.id,e]));return e.map(e=>{const t=r.get(e.episode_id);if(!t)return"";const n=a.get(t.series_id);return`<div class='item'><div style="display:flex;gap:12px;align-items:center;"><img class='thumb' src='${t.thumb||n?.thumb||""}'><div><b>${n?.title||"Serial"}</b><div class='muted-block'>S${t.season}E${t.episode}</div></div></div><button class='small-btn' onclick="location.href='seriale.html?series=${t.series_id}&season=${t.season}&episode=${t.episode}'">â–¶</button></div>`}).join("")}async function logout(){await db.auth.signOut(),location.href="/login/"}(async()=>{const{data:{session:e}}=await db.auth.getSession();e?(currentUser=e.user,document.getElementById("watchAdBtn").onclick=initiateAdProcess,await Promise.all([loadPoints(),loadProfile(),loadCompactHistory(),checkCooldownState()])):location.href="/login/"})();</script></body></html>
