<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>StreamingHub AI ‚Äî Asystent Filmowy (test)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0d10;
    --panel:#0f1216;
    --card:#0b0d10;
    --accent:#6b5ef8;
    --accent-2:#4f7cff;
    --muted:#9aa7be;
    --text:#e6eef8;
    --border:#1f2430;
    --input:#0e1114;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:#09090b;
    color:var(--text);
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  .page {
    max-width:980px;
    margin:28px auto;
    padding:0 20px 60px;
  }

  header {
    text-align:center;
    margin-bottom:18px;
  }
  .brand {
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    color: var(--accent-2);
    font-weight:800;
    font-size:22px;
  }
  .subtitle { color:var(--muted); font-size:13px; margin-top:6px; }

  .divider { height:1px; background:rgba(255,255,255,0.04); margin:20px 0; border-radius:2px; }

  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border-radius:14px;
    padding:18px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.02);
  }

  /* Chat area */
  .chat {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.003));
    border-radius:12px;
    padding:18px;
    height:520px;
    display:flex;
    flex-direction:column;
    gap:12px;
    border:1px solid rgba(255,255,255,0.02);
    overflow:hidden;
  }
  .messages {
    flex:1;
    overflow:auto;
    padding-right:6px;
  }

  .bubble {
    display:inline-block;
    padding:12px 16px;
    border-radius:14px;
    max-width:75%;
    line-height:1.4;
    margin-bottom:12px;
    word-break:break-word;
  }
  .ai {
    background: linear-gradient(90deg, #8b5cf6, #6b5ef8);
    color:white;
    align-self:flex-start;
    border-bottom-left-radius:6px;
  }
  .user {
    background: linear-gradient(90deg, #10b981, #059669);
    color:white;
    align-self:flex-end;
    border-bottom-right-radius:6px;
  }
  .system {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    color:var(--muted);
    align-self:center;
    padding:10px 12px;
    border-radius:10px;
    max-width:90%;
  }

  .input-row {
    display:flex;
    gap:12px;
    align-items:center;
    margin-top:6px;
  }
  .text-input {
    flex:1;
    background:var(--input);
    border:1px solid var(--border);
    color:var(--text);
    padding:12px 16px;
    border-radius:12px;
    outline:none;
    font-size:14px;
  }
  .text-input:focus { box-shadow: 0 0 0 3px rgba(79,124,255,0.12); border-color:var(--accent-2); }

  .btn {
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;
    border:none;
    padding:10px 16px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
  }
  .btn.secondary {
    background:transparent;
    border:1px solid rgba(255,255,255,0.04);
    color:var(--muted);
    padding:8px 12px;
    font-weight:600;
  }

  .note { font-size:13px; color:var(--muted); margin-top:8px; }

  /* Recommendation item */
  .rec-list { display:flex; flex-direction:column; gap:10px; margin-top:6px; }
  .rec {
    display:flex;
    gap:12px;
    align-items:flex-start;
    background: rgba(255,255,255,0.02);
    padding:10px;
    border-radius:10px;
  }
  .rec img { width:118px; height:66px; object-fit:cover; border-radius:8px; }
  .rec .meta { flex:1; }
  .rec .title { font-weight:700; }
  .rec .desc { color:var(--muted); margin-top:6px; font-size:13px; }

  /* small screens */
  @media (max-width:700px) {
    .chat { height:420px; padding:12px; }
    .rec img { width:94px; height:54px; }
  }
</style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">üé¨ StreamingHub AI</div>
      <div class="subtitle">Tw√≥j osobisty asystent filmowy</div>
    </header>

    <div class="divider"></div>

    <div class="panel">
      <div class="chat" role="region" aria-label="Chat z asystentem">
        <div class="messages" id="messages" aria-live="polite">
          <!-- start message -->
          <div class="bubble ai" id="welcome-bubble">Cze≈õƒá U≈ºytkowniku! üé¨ Szukasz czego≈õ dobrego do obejrzenia?</div>
        </div>

        <div class="input-row" style="margin-top:8px">
          <input id="user-input" class="text-input" placeholder="Napisz swojƒÖ odpowied≈∫..." aria-label="Wiadomo≈õƒá u≈ºytkownika" />
          <button id="send-btn" class="btn">Wy≈õlij</button>
          <button id="openai-toggle" class="btn secondary" title="W≈ÇƒÖcz prawdziwe ChatGPT (opcjonalnie)">W≈ÇƒÖcz ChatGPT</button>
        </div>

        <div class="note">Tryb testowy: u≈ºywany jest <strong>anon</strong> Supabase i symulowane AI. Mo≈ºesz w ka≈ºdej chwili kliknƒÖƒá "W≈ÇƒÖcz ChatGPT" i wkleiƒá sw√≥j OpenAI API key ‚Äî wtedy odpowiedzi wygeneruje prawdziwe ChatGPT.</div>
      </div>
    </div>
  </div>

<script type="module">
/*
  Uwaga:
  - Plik dzia≈Ça bez klucza OpenAI (symulacja). Je≈õli chcesz w przysz≈Ço≈õci korzystaƒá z prawdziwego ChatGPT,
    kliknij "W≈ÇƒÖcz ChatGPT" i wklej klucz (sk-...).
  - Supabase anon key, kt√≥re poda≈Çe≈õ wcze≈õniej, zosta≈Ço umieszczone poni≈ºej.
    To OK do test√≥w lokalnych, lecz nie publikuj w produkcji.
*/

// ------------------ KONFIGURACJA SUPABASE (anon key - tylko do test√≥w) ------------------
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const SUPABASE_URL = "https://jjmnacolebxsifmnmqks.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqbW5hY29sZWJ4c2lmbW5tcWtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTcyNDQsImV4cCI6MjA3MTM3MzI0NH0.1hNoBQ4wDuA_t_vscorQ6FRb-aW8IxHEDxuZKEhndv0";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: false } });

// ------------------ ELEMENTY UI ------------------
const messagesEl = document.getElementById('messages');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
const openaiToggle = document.getElementById('openai-toggle');

// ------------------ STAN APLIKACJI ------------------
let conversationHistory = []; // przechowujemy rozmowƒô lokalnie
let preferences = { category:null, mood:null, yearFrom:null, yearTo:null, durationMax:null, keywords:[] };
let useRealOpenAI = false;
let openaiKey = ''; // wkleisz klucz po klikniƒôciu "W≈ÇƒÖcz ChatGPT"
let lastCandidates = []; // przechowamy ostatnie wyniki z Supabase (kontekst dla AI)

// ------------------ Pomocnicze funkcje UI ------------------
function addBubble(text, kind='ai', html=false) {
  const d = document.createElement('div');
  d.className = 'bubble ' + (kind === 'ai' ? 'ai' : kind === 'user' ? 'user' : 'system');
  d.innerHTML = html ? text : escapeHtml(text);
  messagesEl.appendChild(d);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  return d;
}
function escapeHtml(t){ return String(t).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s])); }

// ------------------ LOGIKA PYTA≈É (przyjemne, kr√≥tkie) ------------------
const QUESTIONS = [
  'Jakiego rodzaju film√≥w szukasz? (np. "komedia", "thriller", "romans" lub "-" je≈õli nie wiesz)',
  'Jaki nastr√≥j preferujesz? (np. "lekki", "mroczny", "romantyczny" lub "-")',
  'Masz preferencjƒô co do roku produkcji? (np. "ostatnie 10 lat", rok "2010" lub "-")',
  'Wolisz kr√≥tsze filmy (~<90 min) czy d≈Çu≈ºsze (>120 min)? (albo "-")',
  'Podaj kilka s≈Ç√≥w kluczowych, kt√≥re chcia≈Çby≈õ zobaczyƒá w opisie (np. "podr√≥≈º", "kosmos", "mafia") lub "-"'
];
let questionIndex = 0;

function startConversation(){
  conversationHistory = [];
  preferences = { category:null, mood:null, yearFrom:null, yearTo:null, durationMax:null, keywords:[] };
  questionIndex = 0;
  // replace welcome bubble
  messagesEl.innerHTML = '';
  addBubble('Cze≈õƒá U≈ºytkowniku! üé¨ Szukasz czego≈õ dobrego do obejrzenia?', 'ai');
  setTimeout(()=> addBubble(QUESTIONS[questionIndex], 'ai'), 300);
}
startConversation();

// ------------------ Interpretacja odpowiedzi u≈ºytkownika (prosty parser) ------------------
function interpretAnswer(ans){
  const a = (ans||'').trim();
  if (!a || a === '-') return { consumed:false };
  const low = a.toLowerCase();

  // categories
  const basicCats = ['komedia','thriller','dramat','akcja','fantasy','sci-fi','scifi','science fiction','romans','horror','animacja','dokument'];
  for (const c of basicCats) if (low.includes(c)) return { consumed:true, field:'category', value:c.includes('scifi')||c.includes('science') ? 'sci-fi' : c.replace('science fiction','sci-fi') };

  // mood
  if (low.includes('luz') || low.includes('lekki') || low.includes('relax')) return { consumed:true, field:'mood', value:'light' };
  if (low.includes('mrocz') || low.includes('ciƒô≈º') || low.includes('powa≈º')) return { consumed:true, field:'mood', value:'dark' };
  if (low.includes('romant')) return { consumed:true, field:'mood', value:'romantic' };

  // year
  const years = [...low.matchAll(/(19|20)\d{2}/g)].map(m=>parseInt(m[0]));
  if (years.length===1) return { consumed:true, field:'yearFrom', value:years[0], extra:{yearTo:years[0]} };
  if (years.length>=2) return { consumed:true, field:'yearFrom', value:Math.min(...years), extra:{yearTo:Math.max(...years)} };
  const lastX = low.match(/ostatnie\s+(\d{1,2})\s+lat/);
  if (lastX){ const x=parseInt(lastX[1]); const thisYear=(new Date()).getFullYear(); return { consumed:true, field:'yearFrom', value:thisYear-x, extra:{yearTo:thisYear} }; }
  const lata = low.match(/lata\s+(\d{2})/);
  if (lata){ const a2=parseInt(lata[1]); const from = 1900 + a2; return { consumed:true, field:'yearFrom', value:from, extra:{yearTo:from+9} }; }

  // duration
  if (low.includes('kr√≥t') || low.includes('<90') || low.includes('~<90')) return { consumed:true, field:'durationMax', value:90 };
  if (low.includes('d≈Ç') || low.includes('>120')) return { consumed:true, field:'durationMax', value:180 };

  // keywords (comma separated or multiple words)
  const tokens = low.split(/[,;\/]+/).map(s=>s.trim()).filter(Boolean);
  if (tokens.length>1){ const kws = tokens.flatMap(t=>t.split(/\s+/)).filter(w=>w.length>2); return { consumed:true, field:'keywords', value:kws.slice(0,8) }; }
  if (a.length>2) return { consumed:true, field:'keywords', value:[low] };

  return { consumed:false };
}

// ------------------ Czy mamy wystarczajƒÖco informacji? ------------------
function isPreferencesComplete(pref){
  return (!!pref.category) || (!!pref.mood) || (pref.keywords && pref.keywords.length>0);
}

// ------------------ Obs≈Çuga przycisku wysy≈Çki ------------------
sendBtn.addEventListener('click', onSend);
userInput.addEventListener('keypress', e => { if (e.key === 'Enter') onSend(); });

async function onSend(){
  const text = userInput.value.trim();
  if (!text) return;
  addBubble(text, 'user');
  conversationHistory.push({ role:'user', content:text });
  userInput.value = '';
  userInput.disabled = true;
  sendBtn.disabled = true;

  // special commands
  const low = text.toLowerCase();
  if (low === 'reset') { startConversation(); userInput.disabled=false; sendBtn.disabled=false; return; }
  if ((low === 'tak' || low === 'poka≈º' || low === 'ok') && isPreferencesComplete(preferences)) {
    // user confirmed -> fetch recommendations
    await fetchAndDisplayRecommendations();
    userInput.disabled=false; sendBtn.disabled=false;
    return;
  }

  // interpret answer
  const res = interpretAnswer(text);
  if (res.consumed){
    const f = res.field;
    if (f === 'category') preferences.category = res.value;
    if (f === 'mood') preferences.mood = res.value;
    if (f === 'yearFrom') { preferences.yearFrom = res.value; if (res.extra && res.extra.yearTo) preferences.yearTo = res.extra.yearTo; }
    if (f === 'durationMax') preferences.durationMax = res.value;
    if (f === 'keywords') preferences.keywords = Array.from(new Set([...(preferences.keywords||[]), ...res.value])).slice(0,12);
    addBubble('Super ‚Äî zapisa≈Çem to.', 'ai');
  } else {
    addBubble('Spoko, rozumiem. :)', 'ai');
  }

  // if enough -> ask to confirm
  if (isPreferencesComplete(preferences)) {
    addBubble('Mam ju≈º wystarczajƒÖco informacji. Napisz "tak" aby zobaczyƒá TOP 5 film√≥w, albo podaj co≈õ jeszcze, je≈õli chcesz doprecyzowaƒá.', 'ai');
    userInput.disabled=false; sendBtn.disabled=false;
    userInput.focus();
    return;
  }

  // else -> next question
  questionIndex = Math.min(questionIndex + 1, QUESTIONS.length-1);
  addBubble(QUESTIONS[questionIndex], 'ai');
  userInput.disabled=false; sendBtn.disabled=false;
  userInput.focus();
}

// ------------------ Pobierz filmy z Supabase (kandydaci) ------------------
async function loadCandidates(){
  // pobieramy kandydat√≥w z tabeli movies (limit 200) z podstawowymi filtrami
  try {
    let q = supabase.from('movies').select('id,title,description,thumb,year,duration,category_id').limit(200);
    if (preferences.durationMax) q = q.lte('duration', preferences.durationMax);
    if (preferences.yearFrom) q = q.gte('year', preferences.yearFrom);
    if (preferences.yearTo) q = q.lte('year', preferences.yearTo);
    // if category is textual, try match by category name
    if (preferences.category) {
      // try find category id
      const catResp = await supabase.from('categories').select('id,name').ilike('name', `%${preferences.category}%`).limit(1);
      if (!catResp.error && catResp.data && catResp.data.length>0) {
        q = q.eq('category_id', catResp.data[0].id);
      }
    }
    const { data, error } = await q;
    if (error) throw error;
    lastCandidates = data || [];
    return lastCandidates;
  } catch (err) {
    console.error('Supabase fetch error', err);
    addBubble('B≈ÇƒÖd po≈ÇƒÖczenia z bazƒÖ. Spr√≥buj p√≥≈∫niej.', 'system');
    return [];
  }
}

// ------------------ Scoring lokalny (fallback) ------------------
function scoreCandidates(candidates){
  const keys = (preferences.keywords||[]).map(k=>k.toLowerCase()).filter(Boolean);
  return candidates.map(m => {
    const text = ((m.title||'') + ' ' + (m.description||'') + ' ' + (m.year||'')).toLowerCase();
    let score = 0;
    for (const k of keys) if (text.includes(k)) score += 3;
    if (preferences.category && String(m.category_id) && preferences.category) score += (String(m.category_id) ? 1 : 0);
    if (preferences.mood === 'light' && /fun|comedy|humor|light|romantic|komedi/i.test(text)) score += 2;
    if (preferences.mood === 'dark' && /dark|thrill|horror|murder|mrocz|tragic|thriller/i.test(text)) score += 2;
    if (preferences.yearFrom && m.year && m.year >= preferences.yearFrom) score += 1;
    return { ...m, score };
  }).sort((a,b) => (b.score - a.score) || ((b.year||0) - (a.year||0)));
}

// ------------------ Wy≈õlij kontekst do OpenAI (je≈õli w≈ÇƒÖczone) ------------------
async function callOpenAI(systemPrompt, userPrompt, moviesForContext = []) {
  // Requires openaiKey to be set
  if (!openaiKey) throw new Error('No OpenAI key set');

  // Przygotuj skr√≥conƒÖ listƒô film√≥w (limit 30) z kr√≥tkimi opisami, aby nie przekroczyƒá limit√≥w
  const slice = moviesForContext.slice(0, 30).map(m => ({
    title: m.title || 'Untitled',
    year: m.year || '',
    duration: m.duration || '',
    description: (m.description || '').slice(0, 600),
  }));
  // Zbuduj messages
  const messages = [
    { role:'system', content: systemPrompt },
    { role:'user', content: userPrompt + "\n\nDostƒôpne filmy (skr√≥t):\n" + slice.map((f,i)=>`${i+1}. ${f.title} (${f.year}) ‚Äî ${f.description.slice(0,150)}`).join("\n") }
  ];

  // Wywo≈Çanie API OpenAI Chat Completions (model: gpt-3.5-turbo)
  const resp = await fetch('https://api.openai.com/v1/chat/completions', {
    method:'POST',
    headers: {
      'Content-Type':'application/json',
      'Authorization':'Bearer ' + openaiKey
    },
    body: JSON.stringify({
      model: 'gpt-3.5-turbo',
      messages: messages,
      max_tokens: 600,
      temperature: 0.7
    })
  });

  if (!resp.ok) {
    const txt = await resp.text();
    throw new Error('OpenAI error: ' + resp.status + ' ' + txt);
  }
  const data = await resp.json();
  const content = data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content;
  return content || '';
}

// ------------------ G≈Ç√≥wna funkcja: pobierz rekomendacje i wy≈õwietl TOP5 ------------------
async function fetchAndDisplayRecommendations(){
  addBubble('Szukam film√≥w pasujƒÖcych do Twoich preferencji...', 'ai');

  const candidates = await loadCandidates();
  if (!candidates || candidates.length === 0) { addBubble('Brak film√≥w w bazie dopasowanych do kryteri√≥w.', 'ai'); return; }

  if (useRealOpenAI && openaiKey) {
    // Zbuduj prompt dla ChatGPT: ma wybraƒá top5 i zwr√≥ciƒá ≈Çadny opis + ewentualne follow-up pytania
    const sys = `Jeste≈õ asystentem pomagajƒÖcym u≈ºytkownikowi dobraƒá filmy. Masz listƒô film√≥w z bazy (tytu≈Ç, rok, opis). 
Twoim zadaniem: dobieraƒá TOP 5 najbardziej pasujƒÖcych film√≥w do preferencji u≈ºytkownika, kr√≥tko (2-3 zdania) opisaƒá dlaczego ka≈ºdy pasuje, a na ko≈Ñcu zasugerowaƒá ewentualne pytania follow-up je≈õli wynik nie jest do ko≈Ñca dopasowany. 
Zwr√≥ƒá wynik w czytelnym formacie.`;
    const userPrompt = `Preferencje u≈ºytkownika: ${JSON.stringify(preferences)}.\nWybierz top 5 film√≥w i przedstaw je. Je≈ºeli ≈ºadne filmy nie sƒÖ trafne, zasugeruj co u≈ºytkownik mo≈ºe doprecyzowaƒá.`;

    try {
      const aiText = await callOpenAI(sys, userPrompt, candidates);
      // Wy≈õwietl odpowied≈∫ (HTML-safe)
      addBubble(aiText.replace(/\n/g,'<br>'), 'ai', true);
    } catch (err) {
      console.error(err);
      addBubble('B≈ÇƒÖd przy ≈ÇƒÖczeniu z OpenAI: ' + (err.message || err), 'system');
      // fallback: local scoring
      const scored = scoreCandidates(candidates);
      displayTopLocal(scored);
    }
  } else {
    // Symulacja / fallback: scoring lokalny i wy≈õwietlenie top 5 + kr√≥tkie opisy z opis√≥w
    const scored = scoreCandidates(candidates);
    displayTopLocal(scored);
  }
}

// ------------------ Lokalna prezentacja TOP5 (fallback / symulacja) ------------------
function displayTopLocal(scoredCandidates){
  const top = scoredCandidates.slice(0,5);
  if (!top || top.length===0) { addBubble('Nie znalaz≈Çem dopasowa≈Ñ. Spr√≥buj zmieniƒá preferencje.', 'ai'); return; }

  // zbuduj html
  let html = '<div><strong>Top 5 dopasowanych film√≥w:</strong><div class="rec-list">';
  for (const m of top) {
    const desc = m.description ? (m.description.length>180 ? (m.description.slice(0,177)+'...') : m.description) : '';
    const thumb = m.thumb ? `<img src="${escapeHtml(m.thumb)}" alt="${escapeHtml(m.title)}" onerror="this.style.display=\\'none\\'">` : `<div style="width:118px;height:66px;border-radius:8px;background:rgba(255,255,255,0.02)"></div>`;
    html += `<div class="rec">${thumb}<div class="meta"><div class="title">${escapeHtml(m.title)} ${m.year?('('+m.year+')'):''}</div><div class="desc">${escapeHtml(desc)}</div></div></div>`;
  }
  html += '</div></div>';
  addBubble(html, 'ai', true);

  // follow up suggestion
  addBubble('Je≈õli to nie to, napisz np. inny gatunek, nastr√≥j lub dok≈Çadniejsze s≈Çowa kluczowe ‚Äî chƒôtnie doprecyzujƒô!', 'ai');
}

// ------------------ Obs≈Çuga przycisku w≈ÇƒÖczenia OpenAI (opcjonalne) ------------------
openaiToggle.addEventListener('click', async () => {
  if (!useRealOpenAI) {
    // pop-up prompt to paste key (user doesn't want to now, but we allow later)
    const k = prompt('Je≈õli chcesz korzystaƒá z prawdziwego ChatGPT wklej sw√≥j OpenAI API key (zacznij od "sk-...").\nPozostaw puste, aby pozostaƒá w trybie testowym.');
    if (k && k.trim().length>0) {
      openaiKey = k.trim();
      useRealOpenAI = true;
      openaiToggle.innerText = 'ChatGPT: W≈Å. (kliknij, aby zmieniƒá)';
      openaiToggle.style.borderColor = 'rgba(79,124,255,0.4)';
      addBubble('ChatGPT w≈ÇƒÖczony ‚Äî teraz odpowiedzi bƒôdƒÖ generowane przez OpenAI.', 'system');
    } else {
      alert('Pozostajesz w trybie testowym (symulacja).');
    }
  } else {
    // oferuj reset / wy≈ÇƒÖczenie
    const conf = confirm('Czy wy≈ÇƒÖczyƒá integracjƒô z OpenAI i wr√≥ciƒá do trybu testowego?');
    if (conf) {
      useRealOpenAI = false;
      openaiKey = '';
      openaiToggle.innerText = 'W≈ÇƒÖcz ChatGPT';
      addBubble('ChatGPT wy≈ÇƒÖczony ‚Äî pracujemy w trybie testowym.', 'system');
    }
  }
});

// ------------------ Dodatkowe skr√≥ty: wpis "tak" uruchamia rekomendacje (wewnƒôtrzne) ------------------
userInput.addEventListener('keydown', async (e) => {
  if (e.key === 'Enter') {
    const txt = userInput.value.trim().toLowerCase();
    if (txt === 'tak' || txt === 'ok' || txt === 'poka≈º') {
      addBubble(userInput.value.trim(), 'user');
      userInput.value = '';
      userInput.disabled = true;
      sendBtn.disabled = true;
      await fetchAndDisplayRecommendations();
      userInput.disabled=false; sendBtn.disabled=false;
      return;
    }
  }
});

// ------------------ Accessibility: focus input on load ------------------
window.addEventListener('load', () => { userInput.focus(); });

// ------------------ Koniec skryptu ------------------
</script>
</body>
</html>
