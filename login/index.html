<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StreamingHub ‚Ä¢ Logowanie</title>
  <style>
    :root {
      --bg: #0b0d10;
      --card: #151922;
      --muted: #9fb1d9;
      --text: #e3e7ee;
      --brand: #4f7cff;
      --border: #232a37;
      --google-bg: #ffffff;
      --google-text: #1f1f1f;
      --input-bg: #0e1218;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.5;
    }

    header {
      position: sticky;
      top: 0;
      background: rgba(11, 13, 16, 0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      z-index: 100;
      border-bottom: 1px solid var(--border);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 16px;
    }

    .brand { 
      font-weight: 800; 
      color: var(--text); 
      text-decoration: none; 
      font-size: 1.2rem;
      letter-spacing: -0.5px;
    }

    .menu { display: flex; align-items: center; gap: 16px; }
    .menu a { color: var(--muted); text-decoration: none; font-size: 0.9rem; transition: color .2s; font-weight: 500; }
    .menu a:hover { color: #fff; }

    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 16px;
    }

    .auth-box {
      background: var(--card);
      padding: 32px;
      border-radius: 20px;
      width: 100%;
      max-width: 420px;
      border: 1px solid var(--border);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }

    h2 { text-align: center; margin: 0 0 24px 0; font-size: 1.5rem; font-weight: 700; }
    
    label { display: block; font-size: 0.85rem; color: var(--muted); margin-bottom: 6px; font-weight: 500; }

    input {
      width: 100%; 
      background: var(--input-bg); 
      border: 1px solid var(--border);
      color: #fff; 
      padding: 12px 14px; 
      border-radius: 12px; 
      margin-bottom: 16px;
      font-size: 1rem;
      transition: all 0.2s;
    }

    input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(79, 124, 255, 0.2);
    }

    button {
      width: 100%; 
      background: var(--brand); 
      color: #fff; 
      border: none;
      padding: 14px; 
      border-radius: 12px; 
      cursor: pointer;
      font-weight: 600; 
      font-size: 1rem;
      margin-top: 8px; 
      transition: transform 0.1s, background 0.2s;
    }

    button:hover { background: #668cff; }
    button:active { transform: scale(0.98); }

    .btn-google {
      background: var(--google-bg); 
      color: var(--google-text);
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 12px;
      margin-bottom: 8px;
    }
    .btn-google:hover { background: #f8f9fa; color: #000; }
    .btn-google svg { width: 18px; height: 18px; }

    .separator {
      display: flex; align-items: center; text-align: center;
      color: var(--muted); font-size: 0.8rem; margin: 20px 0;
      text-transform: uppercase; letter-spacing: 1px;
    }
    .separator::before, .separator::after {
      content: ''; flex: 1; border-bottom: 1px solid var(--border);
    }
    .separator::before { margin-right: 12px; }
    .separator::after { margin-left: 12px; }

    .link-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      text-align: center;
    }

    .link { 
      color: var(--muted); 
      cursor: pointer; 
      font-size: 0.85rem; 
      text-decoration: none;
      transition: color 0.2s;
    }
    .link:hover { color: #fff; text-decoration: underline; }

    .captcha {
      display: flex; 
      align-items: center; 
      gap: 10px;
      background: var(--input-bg); 
      padding: 10px; 
      border: 1px solid var(--border);
      border-radius: 12px; 
      margin-bottom: 16px;
    }
    .captcha span { 
      font-family: 'Courier New', monospace; 
      font-size: 1.1rem; 
      letter-spacing: 3px; 
      font-weight: 800;
      background: #232a37;
      padding: 4px 10px;
      border-radius: 6px;
      color: var(--brand);
    }
    .captcha input { margin-bottom: 0; flex: 1; }

    footer {
      text-align: center;
      padding: 24px;
      color: var(--muted);
      font-size: 0.85rem;
      border-top: 1px solid var(--border);
    }

    /* RESPONSYWNO≈öƒÜ MOBILNA */
    @media (max-width: 768px) {
      .nav { padding: 10px 16px; }
      .brand { font-size: 1.1rem; }
      .menu { gap: 10px; }
      .menu a { font-size: 0.8rem; }
      .auth-box { padding: 24px; border: none; box-shadow: none; background: transparent; }
      h2 { font-size: 1.4rem; }
    }

    @media (max-width: 480px) {
      .nav { flex-direction: column; gap: 12px; text-align: center; }
      .menu { width: 100%; justify-content: center; flex-wrap: wrap; }
      main { align-items: flex-start; padding-top: 10px; }
      .auth-box { padding: 16px; width: 100%; }
      input, button { font-size: 16px; } /* Zapobiega auto-zoomowi na iOS */
      .captcha { flex-direction: column; align-items: stretch; }
      .captcha input { width: 100%; }
    }
  </style>
</head>
<body>

<header>
  <div class="nav">
    <a class="brand" href="index.html">üé¨ StreamingHub</a>
    <nav class="menu">
      <a href="/filmy/">Filmy</a>
      <a href="/seriale/">Seriale</a>
      <a href="/moja-biblioteka/">Moja biblioteka</a>
      <a href="/login/" style="color:#fff;">Logowanie</a>
      <a href="#" onclick="showRegister()">Rejestracja</a>
    </nav>
  </div>
</header>

<main>
  <div class="auth-box" id="authBox">
    <h2 id="formTitle">Zaloguj siƒô</h2>

    <div id="googleSection">
      <button class="btn-google" onclick="loginWithGoogle()">
        <svg viewBox="0 0 48 48">
          <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
          <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
          <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
          <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
        </svg>
        Kontynuuj przez Google
      </button>
      <div class="separator">lub emailem</div>
    </div>

    <div id="loginForm">
      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="tw√≥j@email.com" />
      <label>Has≈Ço</label>
      <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <button onclick="login()">Zaloguj siƒô</button>
      <div class="link-container">
        <span class="link" onclick="showReset()">Zapomnia≈Çe≈õ has≈Ça?</span>
        <span class="link" onclick="showRegister()">Nie masz konta? Zarejestruj siƒô</span>
        <span class="link" onclick="sendMagicLink()">Zaloguj siƒô magicznym linkiem ‚ú®</span>
      </div>
    </div>

    <div id="registerForm" style="display:none;">
      <label>Nazwa u≈ºytkownika</label>
      <input type="text" id="regName" placeholder="np. Janek123" />
      <label>Email</label>
      <input type="email" id="regEmail" placeholder="tw√≥j@email.com" />
      <label>Has≈Ço</label>
      <input type="password" id="regPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <label>Powt√≥rz has≈Ço</label>
      <input type="password" id="regPass2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <label>Weryfikacja</label>
      <div class="captcha">
        <span id="captchaText"></span>
        <input type="text" id="captchaInput" placeholder="Kod">
      </div>
      <button onclick="register()">Utw√≥rz konto</button>
      <div class="link-container">
        <span class="link" onclick="showLogin()">Masz ju≈º konto? Zaloguj siƒô</span>
      </div>
    </div>

    <div id="resetForm" style="display:none;">
      <label>Podaj email powiƒÖzany z kontem</label>
      <input type="email" id="resetEmail" placeholder="tw√≥j@email.com" />
      <button onclick="resetPassword()">Wy≈õlij link do resetu</button>
      <div class="link-container">
        <span class="link" onclick="showLogin()">Wr√≥ƒá do logowania</span>
      </div>
    </div>

    <div id="newPassForm" style="display:none;">
      <label>Nowe has≈Ço</label>
      <input type="password" id="newPass1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <label>Powt√≥rz nowe has≈Ço</label>
      <input type="password" id="newPass2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <button onclick="updatePassword()">Zmie≈Ñ has≈Ço i zaloguj</button>
    </div>
  </div>
</main>

<footer>¬© <script>document.write(new Date().getFullYear())</script> StreamingHub</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://jjmnacolebxsifmnmqks.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqbW5hY29sZWJ4c2lmbW5tcWtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTcyNDQsImV4cCI6MjA3MTM3MzI0NH0.1hNoBQ4wDuA_t_vscorQ6FRb-aW8IxHEDxuZKEhndv0";
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const redirectUrl = window.location.origin + window.location.pathname;

db.auth.onAuthStateChange(async (event, session) => {
  if (event === 'PASSWORD_RECOVERY') {
    hideAll();
    document.getElementById("formTitle").innerText = "Ustaw nowe has≈Ço";
    document.getElementById("newPassForm").style.display = "block";
  } 
  else if (event === 'SIGNED_IN') {
    const isRecovery = window.location.hash && window.location.hash.includes("type=recovery");
    if (!isRecovery) {
       window.location.href = "/filmy/";
    }
  }
});

async function loginWithGoogle() {
  const { error } = await db.auth.signInWithOAuth({
    provider: 'google',
    options: { redirectTo: redirectUrl }
  });
  if(error) alert("B≈ÇƒÖd: " + error.message);
}

async function register(){
  const name = document.getElementById("regName").value.trim();
  const email = document.getElementById("regEmail").value.trim();
  const pass = document.getElementById("regPass").value;
  const captcha = document.getElementById("captchaInput").value.trim().toUpperCase();
  const correct = document.getElementById("captchaText").dataset.value;

  if(!name || !email || !pass){ alert("Uzupe≈Çnij pola!"); return; }
  if(captcha !== correct){ alert("Kod captcha niepoprawny!"); generateCaptcha(); return; }

  const { error } = await db.auth.signUp({
    email,
    password: pass,
    options: {
      data: { username: name },
      emailRedirectTo: redirectUrl
    }
  });
  
  if(error) alert("B≈ÇƒÖd: " + error.message);
  else {
    alert("‚úÖ E-mail weryfikacyjny wys≈Çany! Sprawd≈∫ pocztƒô.");
    showLogin();
  }
}

async function login(){
  const email = document.getElementById("loginEmail").value.trim();
  const pass = document.getElementById("loginPass").value;
  const { error } = await db.auth.signInWithPassword({ email, password: pass });
  if(error) alert("B≈ÇƒÖd: " + error.message);
}

async function sendMagicLink(){
  const email = prompt("Podaj email dla magicznego linku:");
  if(!email) return;
  const { error } = await db.auth.signInWithOtp({
    email,
    options: { emailRedirectTo: redirectUrl }
  });
  if(error) alert("B≈ÇƒÖd: " + error.message);
  else alert("‚ú® Magic Link wys≈Çany!");
}

async function resetPassword(){
  const email = document.getElementById("resetEmail").value.trim();
  if(!email) return alert("Podaj email");
  const { error } = await db.auth.resetPasswordForEmail(email, { redirectTo: redirectUrl });
  if(error) alert("B≈ÇƒÖd: " + error.message);
  else alert("üîó Link do resetu wys≈Çany!");
}

async function updatePassword(){
  const p1 = document.getElementById("newPass1").value;
  const p2 = document.getElementById("newPass2").value;
  if(!p1 || p1 !== p2) return alert("Has≈Ça muszƒÖ byƒá identyczne!");
  const { error } = await db.auth.updateUser({ password: p1 });
  if(error) alert("B≈ÇƒÖd: " + error.message);
  else {
    alert("Has≈Ço zmienione! ‚úÖ");
    window.location.href = "/filmy/";
  }
}

function showLogin(){ hideAll(); document.getElementById("formTitle").innerText="Zaloguj siƒô"; document.getElementById("loginForm").style.display="block"; document.getElementById("googleSection").style.display="block"; }
function showRegister(){ hideAll(); generateCaptcha(); document.getElementById("formTitle").innerText="Rejestracja"; document.getElementById("registerForm").style.display="block"; document.getElementById("googleSection").style.display="block"; }
function showReset(){ hideAll(); document.getElementById("formTitle").innerText="Reset has≈Ça"; document.getElementById("resetForm").style.display="block"; }

function hideAll(){ 
  ["loginForm","registerForm","resetForm","newPassForm","googleSection"].forEach(id=> {
    const el = document.getElementById(id);
    if(el) el.style.display="none";
  }); 
}

function generateCaptcha(){
  const code = Math.random().toString(36).substring(2,7).toUpperCase();
  const el = document.getElementById("captchaText");
  if(el) { el.textContent = code; el.dataset.value = code; }
}
generateCaptcha();
</script>
</body>
</html>
