<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StreamingHub ‚Ä¢ Logowanie</title>
  <style>
    :root {
      --bg: #0b0d10;
      --card: #151922;
      --muted: #9fb1d9;
      --text: #e3e7ee;
      --brand: #4f7cff;
      --border: #232a37;
    }
    * { box-sizing: border-box; } /* Dodane dla sp√≥jno≈õci */
    body {
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui, sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    header {
      position:sticky;
      top:0;
      background:rgba(11,13,16,0.85);
      backdrop-filter:blur(6px);
      z-index:10;
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    .nav {
      display:flex;
      align-items:center;
      justify-content:space-between;
      max-width:1200px;
      margin:0 auto;
      padding:12px 16px;
    }
    .brand { font-weight:700; color:var(--text); text-decoration:none; display:flex; align-items:center; gap:8px; }
    .menu { display:flex; align-items:center; gap:18px; }
    .menu a { color:var(--muted); text-decoration:none; font-size:0.95rem; transition:color .2s; }
    .menu a:hover { color:#fff; }

    main {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 16px;
    }

    .auth-box {
      background:var(--card);
      padding:30px 40px;
      border-radius:16px;
      width:100%;
      max-width:400px;
      box-shadow:0 0 25px rgba(0,0,0,.4);
    }
    h2 { text-align:center; margin-bottom:25px; }
    label { display:block; font-size:.9rem; color:var(--muted); margin-bottom:6px; }
    input {
      width:100%; background:#0e1218; border:1px solid var(--border);
      color:#fff; padding:10px 12px; border-radius:10px; margin-bottom:14px;
    }
    button {
      width:100%; background:var(--brand); color:#fff; border:none;
      padding:10px 16px; border-radius:12px; cursor:pointer;
      font-weight:600; margin-top:4px; transition:background .2s;
    }
    button:hover { background:#668cff; }
    .switch, small.link { text-align:center; margin-top:10px; color:var(--muted); cursor:pointer; font-size:.9rem; display:block; }
    .switch:hover, small.link:hover { color:#fff; text-decoration:underline; }
    .captcha {
      display:flex; align-items:center; justify-content:space-between;
      background:#0e1218; padding:8px 12px; border:1px solid var(--border);
      border-radius:10px; margin-bottom:12px; user-select:none;
    }
    .captcha span { font-family:monospace; font-size:1rem; letter-spacing:2px; }
    
    /* üõ†Ô∏è DODANO STYL DLA TOAST/ALERT */
    .alert {
      padding: 10px 14px;
      border-radius: 10px;
      color: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      background: #152031; /* Domy≈õlne info */
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 9999;
      max-width: 90%;
    }

    footer {
      text-align:center;
      padding:20px 0;
      color:var(--muted);
      font-size:0.9rem;
    }
  

/* === MOBILE RESPONSYWNO≈öƒÜ === */
@media (max-width: 900px) {
  .nav { flex-direction: column; gap: 10px; }
  .menu { flex-wrap: wrap; justify-content: center; }
  .auth-box { padding: 24px; }
}

@media (max-width: 600px) {
  h2 { font-size: 1.3rem; }
  input, button { font-size: 14px; padding: 9px 12px; }
  .auth-box { max-width: 90%; padding: 22px; }
}

@media (max-width: 400px) {
  .nav { padding: 8px; }
  .menu a { font-size: 13px; }
  .auth-box { padding: 18px; }
  footer { font-size: 12px; }
}

</style>
</head>
<body>

<header>
  <div class="nav">
    <a class="brand" href="../filmyy.html">üé¨ StreamingHub</a>
    <nav class="menu">
      <a href="../filmyy.html">Filmy</a>
      <a href="../seriale/index.html">Seriale</a>
      <a href="../moja-biblioteka/index.html">Moja biblioteka</a>
      <a href="index.html" style="color:#fff;">Logowanie</a>
      <a href="#" onclick="showRegister()">Rejestracja</a>
    </nav>
  </div>
</header>

<main>
  <div class="auth-box" id="authBox">
    <h2 id="formTitle">Zaloguj siƒô</h2>

    <div id="loginForm">
      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="tw√≥j@email.com" />
      <label>Has≈Ço</label>
      <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <button onclick="login()">Zaloguj siƒô</button>
      <small class="link" onclick="showReset()">Zapomnia≈Çe≈õ has≈Ça?</small>
      <small class="link" onclick="showRegister()">Nie masz konta? Zarejestruj siƒô</small>
      <small class="link" onclick="sendMagicLink()">Zaloguj siƒô magicznym linkiem ‚ú®</small>
    </div>

    <div id="registerForm" style="display:none;">
      <label>Nazwa u≈ºytkownika</label>
      <input type="text" id="regName" placeholder="np. Janek123" />
      <label>Email</label>
      <input type="email" id="regEmail" placeholder="tw√≥j@email.com" />
      <label>Has≈Ço</label>
      <input type="password" id="regPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <label>Powt√≥rz has≈Ço</label>
      <input type="password" id="regPass2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <div class="captcha">
        <span id="captchaText"></span>
        <input type="text" id="captchaInput" placeholder="Przepisz" style="width:100px;">
      </div>
      <button onclick="register()">Utw√≥rz konto</button>
      <small class="link" onclick="showLogin()">Masz ju≈º konto? Zaloguj siƒô</small>
    </div>

    <div id="resetForm" style="display:none;">
      <label>Podaj email</label>
      <input type="email" id="resetEmail" placeholder="tw√≥j@email.com" />
      <button onclick="resetPassword()">Wy≈õlij link do resetu</button>
      <small class="link" onclick="showLogin()">Wr√≥ƒá do logowania</small>
    </div>

    <div id="newPassForm" style="display:none;">
      <label>Nowe has≈Ço</label>
      <input type="password" id="newPass1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <label>Powt√≥rz has≈Ço</label>
      <input type="password" id="newPass2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <button onclick="updatePassword()">Zmie≈Ñ has≈Ço</button>
    </div>
  </div>
</main>

<footer>¬© <script>document.write(new Date().getFullYear())</script> StreamingHub</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://jjmnacolebxsifmnmqks.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqbW5hY29sZWJ4c2lmbW5tcWtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTcyNDQsImV4cCI6MjA3MTM3MzI0NH0.1hNoBQ4wDuA_t_vscorQ6FRb-aW8IxHEDxuZKEhndv0";
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* üõ†Ô∏è DODANA FUNKCJA TOAST */
function toast(msg, type="info"){
  const d=document.createElement("div"); 
  d.className="alert"; 
  d.style.position="fixed";
  d.style.right="16px";
  d.style.bottom="16px";
  d.style.zIndex=9999;
  d.style.padding="10px 14px";
  d.style.borderRadius="10px";
  d.style.color="#fff";
  d.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)";

  if(type==="error") d.style.background="#b33951"; // Czerwone t≈Ço
  else if(type==="success") d.style.background="#2ecc71"; // Zielone t≈Ço
  else d.style.background="#152031"; // Domy≈õlne t≈Ço

  d.textContent=msg; 
  document.body.appendChild(d); 
  setTimeout(()=>d.remove(),3000); 
}

/* ---------- Prze≈ÇƒÖczanie widok√≥w ---------- */
function showLogin(){ hideAll(); document.getElementById("formTitle").innerText="Zaloguj siƒô"; document.getElementById("loginForm").style.display="block"; }
function showRegister(){ hideAll(); generateCaptcha(); document.getElementById("formTitle").innerText="Rejestracja"; document.getElementById("registerForm").style.display="block"; }
function showReset(){ hideAll(); document.getElementById("formTitle").innerText="Reset has≈Ça"; document.getElementById("resetForm").style.display="block"; }
function hideAll(){ ["loginForm","registerForm","resetForm","newPassForm"].forEach(id=>document.getElementById(id).style.display="none"); }

/* ---------- Captcha ---------- */
function generateCaptcha(){
  const code = Math.random().toString(36).substring(2,8).toUpperCase();
  document.getElementById("captchaText").textContent = code;
  document.getElementById("captchaText").dataset.value = code;
}

/* ---------- Rejestracja ---------- */
async function register(){
  const name = document.getElementById("regName").value.trim();
  const email = document.getElementById("regEmail").value.trim();
  const pass = document.getElementById("regPass").value;
  const pass2 = document.getElementById("regPass2").value;
  const captcha = document.getElementById("captchaInput").value.trim().toUpperCase();
  const correct = document.getElementById("captchaText").dataset.value;

  if(!name || !email || !pass){toast("‚ùå Uzupe≈Çnij wszystkie pola!", 'error');return;}
  if(pass !== pass2){toast("‚ùå Has≈Ça nie sƒÖ identyczne!", 'error');return;}
  if(captcha !== correct){toast("‚ùå Captcha niepoprawna!", 'error');generateCaptcha();return;}

  const { data, error } = await db.auth.signUp({
    email,
    password: pass,
    options: {
      data: { username: name },
      emailRedirectTo: "https://cannon1123.github.io/streaminghub1/login.html"
    }
  });
  
  // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
  if(error){
      toast("‚ùå B≈ÇƒÖd rejestracji: "+error.message, 'error');
  }
  else { 
      toast("‚úîÔ∏è Konto utworzone. Sprawd≈∫ e-mail i potwierd≈∫ rejestracjƒô!", 'success'); 
      showLogin();
  }
}

/* ---------- Logowanie ---------- */
async function login(){
  const email = document.getElementById("loginEmail").value.trim();
  const pass = document.getElementById("loginPass").value;
  if(!email||!pass){toast("‚ùå Podaj dane logowania!", 'error');return;}
  const { data, error } = await db.auth.signInWithPassword({ email, password: pass });
  
  // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
  if(error){
      toast("‚ùå B≈ÇƒÖd logowania: "+error.message, 'error');
  }
  else { 
      toast("‚úîÔ∏è Zalogowano!", 'success');
      location.href = "../filmyy.html"; // üõ†Ô∏è ZMIENIONO: na ≈õcie≈ºkƒô wzglƒôdnƒÖ do pliku film√≥w
  }
}

/* ---------- Magic Link ---------- */
async function sendMagicLink(){
  const email = prompt("Podaj sw√≥j email, aby wys≈Çaƒá magiczny link:");
  if(!email) return;
  const { error } = await db.auth.signInWithOtp({
    email,
    options: { emailRedirectTo: "https://cannon1123.github.io/streaminghub1/login.html" }
  });
  
  // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
  if(error){toast("‚ùå B≈ÇƒÖd: "+error.message, 'error');}
  else toast("Magic link zosta≈Ç wys≈Çany! Sprawd≈∫ skrzynkƒô. ‚ú®", 'success');
}

/* ---------- Reset has≈Ça ---------- */
async function resetPassword(){
  const email = document.getElementById("resetEmail").value.trim();
  if(!email){toast("‚ùå Podaj adres e-mail!", 'error');return;}
  const { error } = await db.auth.resetPasswordForEmail(email, {
    redirectTo: "https://cannon1123.github.io/streaminghub1/login.html"
  });
  
  // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
  if(error){toast("‚ùå B≈ÇƒÖd: "+error.message, 'error');}
  else toast("Wys≈Çano link do resetu has≈Ça. Sprawd≈∫ pocztƒô! üìß", 'success');
}

/* ---------- Zmiana has≈Ça ---------- */
async function updatePassword(){
  const p1 = document.getElementById("newPass1").value;
  const p2 = document.getElementById("newPass2").value;
  if(p1 !== p2){toast("‚ùå Has≈Ça nie sƒÖ identyczne!", 'error');return;}
  const { error } = await db.auth.updateUser({ password: p1 });
  
  // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
  if(error){toast("‚ùå B≈ÇƒÖd: "+error.message, 'error');}
  else {
    toast("Has≈Ço zosta≈Ço zmienione pomy≈õlnie ‚úÖ", 'success');
    location.href = "index.html"; // Przekierowanie do logowania w bie≈ºƒÖcym folderze
  }
}

/* ---------- Obs≈Çuga link√≥w z maila (signup / magic link / recovery) ---------- */
(async () => {
  const hash = window.location.hash;

  if (hash.includes("access_token")) {
    const urlParams = new URLSearchParams(hash.replace("#", ""));
    const type = urlParams.get("type");

    try {
      const { data: { session }, error } = await db.auth.getSession();
      if (error) throw error;

      // ‚úÖ Potwierdzenie konta
      if (type === "signup") {
        document.body.innerHTML = `
          <main style="display:flex;justify-content:center;align-items:center;min-height:100vh;flex-direction:column;font-family:sans-serif;color:#e3e7ee;background:#0b0d10;">
            <h2 style="color:#4f7cff;">‚úÖ Konto zosta≈Ço potwierdzone</h2>
            <p>Mo≈ºesz siƒô teraz <a href="index.html" style="color:#4f7cff;text-decoration:underline;">zalogowaƒá</a>.</p>
          </main>
        `;
        return;
      }

      // ‚úÖ Magic Link
      if (type === "magiclink") {
        const access_token = urlParams.get("access_token");
        const refresh_token = urlParams.get("refresh_token");

        const { data, error } = await db.auth.setSession({ access_token, refresh_token });
        if (error) throw error;
        
        // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
        toast("‚úÖ Zalogowano pomy≈õlnie magicznym linkiem!", 'success');
        location.href = "../filmyy.html"; // üõ†Ô∏è ZMIENIONO: na ≈õcie≈ºkƒô wzglƒôdnƒÖ
        return;
      }

      // ‚úÖ Reset has≈Ça
      if (type === "recovery") {
        hideAll();
        document.getElementById("formTitle").innerText = "Ustaw nowe has≈Ço";
        document.getElementById("newPassForm").style.display = "block";
        return;
      }

    } catch (err) {
      console.error(err);
      // üõ†Ô∏è ZMIENIONE ALERT NA TOAST
      toast("‚ùå WystƒÖpi≈Ç b≈ÇƒÖd przy potwierdzaniu linku.", 'error');
      location.href = "index.html";
    }
  }
})();

generateCaptcha();
</script>
</body>
</html>
